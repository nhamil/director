module.exports=function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){r(1),r(2),r(3),r(4),r(30),Director.init(),e.exports.loop=function(){Director.run()}},function(e,t){global.Util=e.exports,Memory.rooms=Memory.rooms||{},Memory.creeps=Memory.creeps||{},Memory.flags=Memory.flags||{},Memory.spawns=Memory.spawns||{},Memory.expandFlags=Memory.expandFlags||{},Memory.needsSpawn=Memory.needsSpawn||{},Util.getBodyCost=function(e){let t=0;for(let r=0;r<e.length;r++)t+=BODYPART_COST[e[r]];return t},Util.creepIsRole=function(e){return t=>t.memory.role===e},Util.randomName=function(e){return e+Math.floor(1e5*Math.random())},Util.getIndexOfClosestCreep=function(e,t){let r=1/0,o=-1;for(let n=0;n<e.length;n++){let i=e[n].pos.getRangeTo(t);i<r&&(o=n,r=i)}return o},Util.getRoomPositionReadData=function(e,t){if("string"!=typeof e)return;let r=e.split(",");try{return new RoomPosition(parseInt(r[0]),parseInt(r[1]),t||r[2])}catch(e){return}},Util.getRoomPositionWriteData=function(e){return e.x+","+e.y+","+e.roomName},Util.arePositionsEqual=function(e,t){return e.x==t.x&&e.y==t.y&&e.roomName==t.roomName},Util.createModifiablePos=function(e){return{x:e.x,y:e.y,roomName:e.roomName}},Util.getDate=function(){return new Date((new Date).getTime()+-18e6).toUTCString().replace("GMT","CST")},Util.expandToFlagFromRoom=function(e,t,r=!0){let o=Game.flags[e];return r&&o?(Memory.expandFlags[e]={from:t},!0):(r||delete Memory.expandFlags[e],!1)},Util.doOrMoveTo=function(e,t,r,o={}){o.ok=o.ok||[OK];let n=0;n=void 0===o.arg?e[r](t):e[r](t,o.arg),-1===o.ok.indexOf(n)&&e.moveTo(t)}},function(e,t){global.Travel=e.exports;let r={};Travel.addMovementOnRoomPosition=function(e){Travel.addMovementOnPos(e.x,e.y,e.roomName)},Travel.addMovementOnPos=function(e,t,o){let n=r[o];if(n){let r=e+","+t,o=n[r]||0;n[r]=Math.min(o+1,20)}},Travel.getPosScore=function(e){let t=r[e.roomName];return t?t[e.x+","+e.y]:0},Travel.shouldPosHaveRoad=function(e,t,r){return Travel.getPosScore({x:e,y:t,roomName:r})>=9},Travel.shouldPosKeepRoad=function(e,t,r){return Travel.getPosScore({x:e,y:t,roomName:r})>=7},Travel.preFrame=function(){Memory.rooms=Memory.rooms||{};for(let e in Memory.rooms)Game.rooms[e]||Memory.rooms[e].map&&delete Memory.rooms[e].map;for(let e in Game.rooms){let t={},o=Memory.rooms[e]=Memory.rooms[e]||{};if(o.map)for(let e in o.map)t[e]=parseInt(o.map[e])||0;if(Game.time%150==0)for(let e in t)t[e]=Math.max(0,t[e]-1);r[e]=t}Game.time%150==0&&console.log("Decaying travel paths")},Travel.postFrame=function(){for(let e in Game.rooms){let t=r[e],o=Memory.rooms[e]=Memory.rooms[e]||{};if(t){for(let e in t)t[e]||delete t[e];o.map=t}}},Travel.drawVisuals=function(e){}},function(e,t){global.Directive=e.exports;const r={harvest:"üåæ",mine:"‚õèÔ∏è",upgrade:"üí™",build:"üèóÔ∏è",supply:"üöö",withdraw:"üåæ",repair:"üõ†Ô∏è"};Directive.assignTaskToCreep=function(e,t){e.memory.task=t;let o=r[t.id]||t.id;e.say(o)},Directive.getCreepTaskName=function(e){return(e.memory.task||{}).id},Directive.getCreepTask=function(e){return e.memory.task},Directive.doesCreepHaveTask=function(e){return null!=Directive.getCreepTaskName(e)},Directive.finishCreepTask=function(e){delete e.memory.task},Directive.forEachCreepOfRoomAndRole=function(e,t,r){let o=Directive.ctor.getCreepsByHomeroomAndRole(e,t);for(let e=0;e<o.length;e++){r(o[e],o)}},Directive.forEachCreep=function(e,t){for(let r=0;r<e.length;r++){t(e[r],e)}}},function(e,t,r){global.Director=e.exports;let o=[],n=Game.time,i=[];Director.tasks={build:r(5),claim:r(6),guard:r(7),mine:r(8),repair:r(9),supply:r(10),upgrade:r(11),withdraw:r(12)},Director.directives={build:r(13),defense:r(14),expand:r(15),general:r(16),mine:r(17),repair:r(18),spawn:r(19),supply:r(20),upgrade:r(21)},Director.roles={brute:r(22),builder:r(23),claimer:r(24),general:r(25),miner:r(26),repairer:r(27),supplier:r(28),upgrader:r(29)},Director.visual=new RoomVisual,Director.setDisplayTravel=function(e){return Memory.displayTravel=e||!1,e?"Displaying travel data":"Hiding travel data"},Director.log=function(e,t){let r=e||"";"string"!=typeof r&&(r=JSON.stringify(r)),i.push(r),t&&console.log(r)},Director.getSpawnRequestForRoom=function(e){for(let t in o){let r=o[t];if(r.room===e.name)return o.splice(parseInt(t),1),r}return null},Director.isSpawnRequestedForRoom=function(e){for(let t in o){if(o[t].room==e.name)return!0}return!1},Director.requestSpawn=function(e,t,r,n){o.push({room:e.name,role:t,now:r,priority:void 0===n?1e3:n}),o.sort((e,t)=>e.priority-t.priority)},Director.init=function(){console.log("Initializing the Director...")};Director.run=function(){o=[],i=[],Travel.preFrame(),Director.log("Current time: "+Util.getDate()),Director.displayTravel&&Director.log("Displaying Travel Data"),function(){let e=Game.time-n>=30;{n=Game.time;let t={};for(let e in Game.creeps){let r=Game.creeps[e].memory.role||"unknown";t[r]=(t[r]||0)+1}let r=_.keys(t);r.sort();let o=void 0;for(let e in r){let n=r[e],i=(Director.roles[n]||{}).initial||n;o?o+=" "+i+":"+t[n]:o=i+":"+t[n]}o="Population ("+_.sum(t)+"): "+o,Director.log(o,e)}}();for(let e in Game.rooms)try{let t=Game.rooms[e];s(t)&&c(t)}catch(e){Director.log(e),console.log(e.stack),Game.notify(e.stack)}for(let e in Game.creeps)try{let t=Game.creeps[e];if(t.memory&&t.memory.role)if(t.body.length<=1)console.log(t.name+" is too weak: suiciding"),t.suicide();else if(Directive.doesCreepHaveTask(t)){let e=Directive.getCreepTaskName(t),r=Director.tasks[e];if(r){r.run(t,t.memory.task)&&Directive.finishCreepTask(t)}else console.log(t.name+" has invalid task: "+e),Directive.finishCreepTask(t)}else t.spawning||Director.log(t.name+" is idle");else console.log(t.name+" does not have a role: suiciding"),t.suicide()}catch(e){Director.log(e),console.log(e.stack),Game.notify(e.stack)}if(l(),function(){for(let e in i){let t=i[e];Director.visual.text(t,1,1+parseInt(e),{align:"left",font:"0.8 monospace"})}}(),Travel.postFrame(),Memory.displayTravel)for(let e in Game.rooms)Travel.drawVisuals(Game.rooms[e])},Director.getCreepsByHomeroom=function(e){return _.filter(Game.creeps,t=>t.memory.home===e.name)},Director.getCreepsByHomeroomAndRole=function(e,t){let r={};if("string"==typeof t)r[t]=!0;else for(let e in t)r[t[e]]=!0;return _.filter(Game.creeps,t=>t.memory.home===e.name&&r[t.memory.role])},Director.getCreepsByHomeroomAndRoleWithoutTask=function(e,t){let r={};if("string"==typeof t)r[t]=!0;else for(let e in t)r[t[e]]=!0;return _.filter(Game.creeps,t=>t.memory.home===e.name&&r[t.memory.role]&&!t.memory.task)};let l=function(){a("creeps"),a("powerCreeps"),a("spawns"),a("flags");for(let e in Memory.rooms)0===_.values(Memory.rooms[e]).length&&delete Memory.rooms[e]},a=function(e){for(let t in Memory[e])Game[e][t]||delete Memory[e][t]},s=function(e){return e&&e.controller&&e.controller.my},c=function(e){0===_.filter(Game.spawns,t=>t.room===e).length?Memory.needsSpawn[e.name]=!0:delete Memory.needsSpawn[e.name];let t=m(e.controller.level);for(let r=0;r<t.length;r++){let o=Director.directives[t[r]];o?o.run(e):console.log('Unknown directive "'+t[r]+'"')}},u={1:["general","spawn"],2:["defense","mine","repair","supply","expand","build","upgrade","spawn"]},m=function(e){for(let t=e;t>=1;t--)if(u[t])return u[t];return console.log("ERROR: No directives for RCL "+e),[]}},function(e,t){e.exports.run=function(e,t){let r=t.target,o=Game.getObjectById(r);return r&&o?(Util.doOrMoveTo(e,o,"build"),0===e.carry.energy):(console.log("Build target is invalid: "+r),!0)}},function(e,t){e.exports.run=function(e,t){let o=t.target;if(!o)return console.log(e.name+" has no flag target, quitting: "+JSON.stringify(t.target)),!0;let n=Game.flags[o];return n?e.room===n.room?r(e,n):void e.moveTo(n):(console.log(e.name+" has invalid flag id, quitting"),!0)};let r=function(e,t){let r=e.room.controller;if(!r)return console.log(e.name+" was given a claim room without a controller, quitting"),!0;if(e.claimController(r)===OK){let r=e.name+" successfully claimed room "+e.room.name;console.log(r),Game.notify(r);let o=e.room.name;return(Memory.rooms[o]=Memory.rooms[o]||{}).requestSpawn=Util.getRoomPositionWriteData(t.pos),!0}e.moveTo(r)}},function(e,t){e.exports.run=function(e){let t=_.filter(e.room.find(FIND_CREEPS),e=>!e.my),r=_.filter(e.body,e=>e.type===ATTACK).length>0,o=_.filter(e.body,e=>e.type===RANGED_ATTACK).length>0,n=_.filter(e.body,e=>e.type===HEAL).length>0;if(r||o)if(t.length>0){let n=t[0];e.moveTo(n.pos),r&&e.attack(n),o&&e.rangedAttack(n)}else e.moveTo(e.room.controller);else{if(!n)return console.log(e.name+" has no combat abilities"),!0;console.log("TODO: heal")}}},function(e,t){e.exports.run=function(e,t){let r=Util.getRoomPositionReadData(t.pos);if(!r)return console.log("Invalid target position, cannot mine"),!0;let o=Game.getObjectById(t.target);if(!o)return console.log("Invalid target ID (did a container decay?), cannot mine"),!0;if(Util.arePositionsEqual(e.pos,r))e.harvest(o);else{e.moveTo(r)!==OK&&e.moveTo(o)}}},function(e,t){e.exports.run=function(e,t){t.roomName||e.room.name;let r=Game.getObjectById(t.target);return r?(Util.doOrMoveTo(e,r,"repair"),0===e.carry[RESOURCE_ENERGY]||r.hits===r.hitsMax):(console.log("Invalid repair ID: "+t.id),!0)}},function(e,t){e.exports.run=function(e,t){let r=t.target,o=Game.getObjectById(r);return o?(Util.doOrMoveTo(e,o,"transfer",{arg:RESOURCE_ENERGY}),0===e.carry[RESOURCE_ENERGY]||o.energy&&o.energy===o.energyCapacity||o.carry&&_.sum(o.carry)===o.carryCapacity):(console.log("Invalid target id: "+r),!0)}},function(e,t){e.exports.run=function(e,t){let r=t.target||e.room.name,o=Game.rooms[r].controller;return Util.doOrMoveTo(e,o,"upgradeController",{ok:[OK,ERR_NOT_ENOUGH_ENERGY]}),0===e.carry[RESOURCE_ENERGY]}},function(e,t){const r=e.exports;let o={[STRUCTURE_CONTAINER]:!0,[STRUCTURE_STORAGE]:!0};r.run=function(e,t){t.noStorage?o[STRUCTURE_STORAGE]=!1:o[STRUCTURE_STORAGE]=!0;let r=Game.getObjectById(t.targetId),a=t.targetType,s=!1,c=e.carryCapacity-_.sum(e.carry);return r&&a&&("dropped"===a?r.amount>c&&(Util.doOrMoveTo(e,r,"pickup"),s=!0):"structure"===a&&r.store[RESOURCE_ENERGY]>c&&(Util.doOrMoveTo(e,r,"withdraw",{arg:RESOURCE_ENERGY}),s=!0)),s||!t.dontPrioritizePickup&&n(e,t)||i(e,t)||n(e,t)||l(e,t),_.sum(e.carry)==e.carryCapacity};let n=function(e,t){let r=e.carryCapacity-_.sum(e.carry),o=e.pos.findClosestByPath(FIND_DROPPED_RESOURCES,{filter:e=>e.resourceType===RESOURCE_ENERGY&&e.amount>r});if(o)return Util.doOrMoveTo(e,o,"pickup"),t.targetId=o.id,t.targetType="dropped",!0},i=function(e,t){let r=e.carryCapacity-_.sum(e.carry),n=e.pos.findClosestByPath(FIND_STRUCTURES,{filter:e=>o[e.structureType]&&e.store[RESOURCE_ENERGY]>r});if(n)return Util.doOrMoveTo(e,n,"withdraw",{arg:RESOURCE_ENERGY}),t.targetId=n.id,t.targetType="structure",!0},l=function(e,t){let r=e.pos.findClosestByPath(FIND_SOURCES_ACTIVE);if(r)return Util.doOrMoveTo(e,r,"harvest"),delete t.targetId,delete t.targetType,!0}},function(e,t){const r=e.exports;let o={[STRUCTURE_CONTAINER]:100,[STRUCTURE_ROAD]:10,[STRUCTURE_EXTENSION]:200,[STRUCTURE_STORAGE]:50,[STRUCTURE_TOWER]:70},n=function(e){return o[e]||0};r.run=function(e){p(e),s(e),e.controller.level>1&&Game.time%50==0&&u(e),a(e),l(e),g(e),d(e),Director.log("TODO handleNewRooms"),i(e),m(e)};let i=function(e){for(let t in Memory.needsSpawn){if(!Memory.needsSpawn[t])continue;Director.log("Attempting to send builder from "+e.name+" to "+t);let r=Game.rooms[t];if(r){let t=_.filter(Game.constructionSites,e=>e.room===r&&e.structureType===STRUCTURE_SPAWN);if(0===t.length)continue;if(0===Director.getCreepsByHomeroom(r).length){let r=Director.getCreepsByHomeroomAndRoleWithoutTask(e,"builder");0===(r=_.filter(r,e=>!0)).length?Director.log("Requesting new builder for target"):(Director.log("Sending idle builder to target ("+r[0].name+")"),0!==r[0].carry.energy&&Directive.assignTaskToCreep(r[0],{id:"build",target:t[0].id}))}}}},l=function(e){let t=e.controller.level,r=CONTROLLER_STRUCTURES[STRUCTURE_TOWER][t],o=e.find(FIND_STRUCTURES,{filter:e=>e.structureType==STRUCTURE_TOWER}),n=e.find(FIND_MY_SPAWNS);if(!n||0===n.length)return;let i=r-o.length;for(;i>0;){let t=c(e,n[0].pos);t&&t.createConstructionSite(STRUCTURE_TOWER),i--}},a=function(e){if(e.controller.level>=4&&!e.storage&&!_.find(e.find(FIND_CONSTRUCTION_SITES,e=>e.structureType=STRUCTURE_STORAGE)))try{let t=e.find(FIND_MY_SPAWNS);if(t&&t.length>0){let r=e.controller,o=t[0],n=PathFinder.search(r.pos,o).path,i=n[Math.min(n.length-1,4)];e.createConstructionSite(i.x,i.y,STRUCTURE_STORAGE)}}catch(e){console.log(e)}},s=function(e){let t=e.controller.level,r=CONTROLLER_STRUCTURES[STRUCTURE_EXTENSION][t]-_.filter(Game.structures,t=>t.room===e&&t.structureType===STRUCTURE_EXTENSION).length;if(!r)return;Director.log("Remaining Extensions: "+r);let o=r-_.filter(Game.constructionSites,t=>t.structureType===STRUCTURE_EXTENSION&&t.room===e).length,n=_.filter(Game.spawns,t=>t.room==e)[0];if(o){c(e,n.pos).createConstructionSite(STRUCTURE_EXTENSION)}},c=function(e,t){let r=1,o=t.x+t.y,n={plain:!0,swamp:!0};for(;r<30;){for(let i=t.y-r;i<=t.y+r;i++)if(!(i<0||i>=50))for(let l=t.x-r;l<=t.x+r;l++){if((l+i+o)%2!=0)continue;if(l<0||l>=50)continue;let t=e.lookAt(l,i),r=!0;for(let e in t){let o=t[e];if(o.structure&&o.structure.structureType!==STRUCTURE_ROAD){r=!1;break}if(o.constructionSite){r=!1;break}if(o.terrain&&!n[o.terrain]){r=!1;break}}if(r)return e.getPositionAt(l,i)}r++}},u=function(e){_.filter(Game.constructionSites,t=>t.room===e);for(let t=0;t<50;t++)for(let r=0;r<50;r++)if(Travel.shouldPosHaveRoad(r,t,e.name)){let o=e.lookForAt(LOOK_STRUCTURES,r,t),n=!1;for(let e of o)if(e.structureType===STRUCTURE_ROAD){n=!0;break}n||0!==e.lookForAt(LOOK_CONSTRUCTION_SITES,r,t).length||e.createConstructionSite(r,t,STRUCTURE_ROAD)}else if(!Travel.shouldPosKeepRoad(r,t,e.name)){let o=e.lookForAt(LOOK_CONSTRUCTION_SITES,r,t);o.length>0&&o[0].structureType===STRUCTURE_ROAD&&o[0].remove()}},m=function(e){let t=_.filter(Game.constructionSites,t=>t.room===e);t.sort((e,t)=>n(t.structureType)-n(e.structureType));let r=t[0],o=Director.getCreepsByHomeroomAndRole(e,["builder","repairer"]),i=Director.getCreepsByHomeroomAndRole(e,["builder"]);if(r){Director.log("Build Target for "+e.name+": "+r.structureType);for(let e in o){let t=o[e];Directive.doesCreepHaveTask(t)||(0===t.carry.energy?Directive.assignTaskToCreep(t,{id:"withdraw"}):Directive.assignTaskToCreep(t,{id:"build",target:r.id}))}}i.length<Math.min(e.controller.level-1,2)&&Director.requestSpawn(e,"builder")},p=function(e){let t=e.find(FIND_SOURCES),r=e.memory;r.sourceContainers=r.sourceContainers||{};for(let e in t){let o=t[e],n=r.sourceContainers[o.id];if(n){let e=Util.getRoomPositionReadData(n);0===e.findInRange(FIND_STRUCTURES,0,{filter:e=>e.structureType===STRUCTURE_CONTAINER}).length&&0===e.findInRange(FIND_CONSTRUCTION_SITES,0).length&&e.createConstructionSite(STRUCTURE_CONTAINER)}else{let e=f(o);e&&(e.createConstructionSite(STRUCTURE_CONTAINER),r.sourceContainers[o.id]=Util.getRoomPositionWriteData(e,!1))}}},f=function(e){let t=e.room.controller;if(t){let r=PathFinder.search(e.pos,t.pos);if(r&&r.path&&r.path.length>0)return r.path[0];console.log("Could not find path from source to controller in room "+e.room.name+". This shouldn't be possible")}},g=function(e){Director.log("TODO handle walls");let t=e.find(FIND_EXIT);for(let r=0;r<t.length;r++){let o=t[r];e.visual.rect(o.x-.5,o.y-.5,1,1)}},d=function(e){Director.log("TODO handle base ramparts")}},function(e,t){e.exports.run=function(e){let t={army:Director.getCreepsByHomeroomAndRole(e,["brute","ranger","healer"]),brutes:Director.getCreepsByHomeroomAndRole(e,"brute"),rangers:Director.getCreepsByHomeroomAndRole(e,"ranger"),healers:Director.getCreepsByHomeroomAndRole(e,"healer"),idleArmy:Director.getCreepsByHomeroomAndRoleWithoutTask(e,["brute","ranger","healer"]),idleBrutes:Director.getCreepsByHomeroomAndRoleWithoutTask(e,"brute"),idleRangers:Director.getCreepsByHomeroomAndRoleWithoutTask(e,"ranger"),idleHealers:Director.getCreepsByHomeroomAndRoleWithoutTask(e,"healer")};r(e,t)};let r=function(e,t){let r=_.filter(t.brutes,e=>"guard"===Directive.getCreepTaskName(e)),o=Math.min(e.controller.level,2),n=e.find(FIND_CREEPS,{filter:e=>!e.my});if(n.length>0){let t=n[0].owner.username;Director.log("EMERGENCY: Spawn extra defense, under attack from "+t+" in room "+e.name);let r=Util.getDate();"Invader"==t?Memory.lastInvaderTime=r+" in room "+e.name:(Memory.lastAttacked=r+" in room "+e.name,Memory.lastAttacker=t,Game.time%10==0&&Game.notify("["+r+"] Under attack by "+t+" in room "+e.name)),Memory.attackHistory=Memory.attackHistory||{},Memory.attackHistory[t]=r+" in room "+e.name,Director.requestSpawn(e,"brute",!0,0);let o=e.find(FIND_STRUCTURES,{filter:e=>e.structureType===STRUCTURE_TOWER});for(let e of o)e.attack(n[0])}if(r.length>=o)Director.log("Standard defenses engaged for room "+e.name);else{Director.log("Activating standard defenses for room "+e.name);for(let e of t.idleArmy)Directive.assignTaskToCreep(e,{id:"guard"}),o--;o>0&&Director.requestSpawn(e,"brute")}for(let e of t.idleArmy)Directive.assignTaskToCreep(e,{id:"guard"}),o--;Memory.lastInvaderTime&&Director.log("Last invasion at "+Memory.lastInvaderTime),Memory.lastAttacked&&Director.log("Last attacked at "+Memory.lastAttacked+" by "+Memory.lastAttacker)}},function(e,t){e.exports.run=function(e){for(let t in Memory.expandFlags){let o=Memory.expandFlags[t];if(o&&o.from===e.name&&Game.flags[t]){let o=Game.flags[t],n=Game.rooms[o.pos.roomName];if(n&&n.controller&&n.controller.my)n.createConstructionSite(o.pos.x,o.pos.y,STRUCTURE_SPAWN);else{let o=Director.getCreepsByHomeroomAndRole(e,"claimer");if(0===_.filter(o,e=>e.memory&&e.memory.task&&"claim"===e.memory.task.id&&e.memory.task.target===t).length){r(e,Game.flags[t]);break}}}}};let r=function(e,t){Director.log("Trying to expand to "+t.pos.roomName+" from "+e.name);let r=Director.getCreepsByHomeroomAndRoleWithoutTask(e,"claimer");if(0===r.length)Director.requestSpawn(e,"claimer");else{let e=r[0];Directive.assignTaskToCreep(e,{id:"claim",target:t.name})}}},function(e,t){e.exports.run=function(e){Director.requestSpawn(e,"general");let t=Director.getCreepsByHomeroomAndRoleWithoutTask(e,["upgrader","general","builder","repairer"]);Director.log(e.name+" workers: "+t.length);let o=Director.getCreepsByHomeroomAndRole(e,["upgrader","general","builder","repairer"]);Director.log(e.name+" all workers: "+o.length),Directive.forEachCreep(t,t=>r(t,e))};let r=function(e,t){console.log("assigning task to "+e.name),e.carry.energy?Directive.assignTaskToCreep(e,{id:"upgrade",target:t.name}):Directive.assignTaskToCreep(e,{id:"withdraw"})}},function(e,t){e.exports.run=function(e){let t=Director.getCreepsByHomeroomAndRole(e,"miner"),r=e.find(FIND_SOURCES),o={},n=[];for(let e of t){let t=Directive.getCreepTask(e);t?"mine"===t.id?t.target?e.ticksToLive>50&&(o[t.target]=!0):(Directive.finishCreepTask(e),n.push(e)):console.log(e.name+" should have a mining task but does't"):n.push(e)}for(let i in r){let l=r[i];if(!o[l.id]){let r=-1,o=1/0;for(let e in n){let t=n[e].pos.getRangeTo(l.pos);t<o&&(r=e,o=t)}if(-1!==r){let t=n[r];n=n.splice(parseInt(r));let o=Memory.rooms[e.name].sourceContainers,i=void 0;o&&(i=o[l.id]),i||(i=Util.getRoomPositionWriteData(l.pos)),Directive.assignTaskToCreep(t,{id:"mine",target:l.id,pos:i})}else Director.requestSpawn(e,"miner",0===t.length,50)}}}},function(e,t){const r=e.exports;let o={1:1,2:100,3:1e3,4:1e3,5:1e3,6:1e3,7:1e3,8:1e3};r.run=function(e){let t=e.controller.level,r=_.filter(e.find(FIND_STRUCTURES),e=>void 0!==e.hits&&(e.structureType!==STRUCTURE_ROAD||Travel.shouldPosKeepRoad(e.pos.x,e.pos.y,e.pos.roomName)&&(e.structureType!==STRUCTURE_WALL||e.hits<o[t])));r.sort((e,t)=>{let r=t.hits/t.hitsMax;return e.hits/e.hitsMax<r?-1:1});let n=r[0],i=Director.getCreepsByHomeroomAndRole(e,["repairer"]);if(n&&n.hits!==n.hitsMax){Director.log("Repair Target for "+e.name+": "+n.structureType);let t=e.find(FIND_STRUCTURES,{filter:e=>e.structureType===STRUCTURE_TOWER&&0!==e.energy}),o=e.find(FIND_CREEPS,{filter:e=>!e.my});if(t.length>0&&0===o.length)for(let e in t){let o=r[e];o&&t[e].repair(o)}else for(let e in i){let t=i[e],o=r[e];Directive.doesCreepHaveTask(t)||(0===t.carry.energy?Directive.assignTaskToCreep(t,{id:"withdraw"}):o&&Directive.assignTaskToCreep(t,{id:"repair",target:o.id}))}}i.length<Math.min(2,e.controller.level)&&Director.requestSpawn(e,"repairer")}},function(e,t){e.exports.run=function(e){for(let t in Game.spawns){let o=Game.spawns[t];o.room===e&&r(e,o)}};let r=function(e,t){let n=Director.getSpawnRequestForRoom(e);if(n){let i='Request to spawn "'+n.role+'" for room '+n.room;n.now&&(i+=" immediately"),Director.log(i);let l=n.role,a=Director.roles[l],s=n.now?e.energyAvailable:e.energyCapacityAvailable;if(0===Director.getCreepsByHomeroomAndRole(e,"supplier").length&&(s=e.energyAvailable),a){let n=a.getBuild(s);n?o(t,e.name,l,n):(console.log('Role "'+l+'" did not provide a build, trying next request'),r(e,t))}else console.log('Unknown role "'+l+'", cannot spawn')}},o=function(e,t,r,o){let n=Util.randomName(r);e.spawnCreep(o,n,{memory:{role:r,home:t}})===OK&&console.log("Spawned "+n+" in room "+t+" ("+o+")")}},function(e,t){const r=e.exports;let o={[STRUCTURE_SPAWN]:10,[STRUCTURE_EXTENSION]:20,[STRUCTURE_TOWER]:7,[STRUCTURE_STORAGE]:5};r.run=function(e){let t=Director.getCreepsByHomeroomAndRole(e,["supplier","repairer"]),r=e.find(FIND_STRUCTURES,{filter:e=>o[e.structureType]&&(void 0!==e.energy&&e.energy<e.energyCapacity||void 0!==e.carry&&_.sum(e.carry)<e.carryCapacity||e.store&&_.sum(e.store)<e.storeCapacity)});r.sort((e,t)=>o[t.structureType]-o[e.structureType]);let n=0,i=[];for(let e of t)e.ticksToLive>100&&"supplier"===e.memory.role&&n++,Directive.doesCreepHaveTask(e)||(0===e.carry[RESOURCE_ENERGY]?Directive.assignTaskToCreep(e,{id:"withdraw",noStorage:1===r.length&&r[0].structureType===STRUCTURE_STORAGE}):i.push(e));n<(e.storage?2:1)&&Director.requestSpawn(e,"supplier",0===t.length,0===t.length?0:100);let l=0;for(;i.length>0&&r.length>l;){l=0;for(let e of r){if(e.structureType===STRUCTURE_CONTAINER){let t=e.pos.findInRange(FIND_SOURCES,1);if(t&&t.length>0)continue}let t=Util.getIndexOfClosestCreep(i,e);if(-1!==t){let r=i[t];Directive.assignTaskToCreep(r,{id:"supply",target:e.id}),i.splice(t,1)}else l++}}}},function(e,t){e.exports.run=function(e){let t=Director.getCreepsByHomeroomAndRole(e,["upgrader","general","builder","repairer"]),o=Director.getCreepsByHomeroomAndRole(e,["upgrader","general"]),n=_.filter(t,e=>!Directive.doesCreepHaveTask(e));(t.length<2||o.length<2)&&Director.requestSpawn(e,"upgrader",0===t.length,0===t.length?1e3:100),Directive.forEachCreep(n,t=>r(t,e))};let r=function(e,t){e.carry.energy?Directive.assignTaskToCreep(e,{id:"upgrade",target:t.name}):Directive.assignTaskToCreep(e,{id:"withdraw",dontPrioritizePickup:!0})}},function(e,t){const r=e.exports;r.initial="Br";let o={[TOUGH]:1,[ATTACK]:2,[RANGED_ATTACK]:3,[MOVE]:4};r.getBuild=function(e){let t=[MOVE,ATTACK,RANGED_ATTACK];e=Math.min(800,e);let r=[RANGED_ATTACK,TOUGH,TOUGH,TOUGH],n=0;for(;Util.getBodyCost(t)<=e;)t.push(r[n]),(n=(n+1)%r.length)%2==0&&t.push(MOVE);for(;t.length>3&&Util.getBodyCost(t)>e;)t.pop();return t.sort((e,t)=>o[e]-o[t]),t}},function(e,t){const r=e.exports;r.initial="B",r.getBuild=function(e){let t=[MOVE,CARRY,WORK];e=Math.min(800,e);let r=[CARRY,WORK],o=0;for(;Util.getBodyCost(t)<=e;)t.push(r[o]),0==(o=(o+1)%r.length)&&t.unshift(MOVE);for(;Util.getBodyCost(t)>e;)t.pop();return t.reverse()}},function(e,t){const r=e.exports;r.initial="C",r.getBuild=function(e){return[MOVE,CLAIM,MOVE]}},function(e,t){const r=e.exports;r.initial="G",r.getBuild=function(e){return[WORK,CARRY,MOVE]}},function(e,t){const r=e.exports;r.initial="M",r.getBuild=function(e){let t=[MOVE,WORK,WORK],r=0;for(;Util.getBodyCost(t)<=e&&r++<4;)t.push(WORK);return t.pop(),t.reverse()}},function(e,t){const r=e.exports;r.initial="R",r.getBuild=function(e){let t=[MOVE,CARRY,WORK];e=Math.min(800,e);let r=[CARRY,WORK],o=0;for(;Util.getBodyCost(t)<=e;)t.push(r[o]),0==(o=(o+1)%r.length)&&t.unshift(MOVE);for(;Util.getBodyCost(t)>e;)t.pop();return t.reverse()}},function(e,t){const r=e.exports;r.initial="S",r.getBuild=function(e){let t=[MOVE,CARRY,WORK];e=Math.min(800,e);let r=[CARRY,CARRY],o=0;for(;Util.getBodyCost(t)<=e;)t.push(r[o]),0==(o=(o+1)%r.length)&&t.unshift(MOVE);for(;t.length>3&&Util.getBodyCost(t)>e;)t.pop();return t.reverse()}},function(e,t){const r=e.exports;r.initial="U",r.getBuild=function(e){let t=[MOVE,CARRY,WORK];e=Math.min(800,e);let r=[CARRY,WORK],o=0;for(;Util.getBodyCost(t)<=e;)t.push(r[o]),0==(o=(o+1)%r.length)&&t.unshift(MOVE);for(;t.length>3&&Util.getBodyCost(t)>e;)t.pop();return t.reverse()}},function(e,t){Creep.prototype._moveTo=Creep.prototype.moveTo,Creep.prototype._move=Creep.prototype.move;const r={1:0,2:1,3:1,4:1,5:0,6:-1,7:-1,8:-1},o={1:-1,2:-1,3:0,4:1,5:1,6:1,7:0,8:-1},n={};Creep.prototype.moveTo=function(e,t,r){let o=this._moveTo(e,t,r);return OK,o},Creep.prototype.move=function(e){let t=this._move(e);if(t===OK){let t=this.pos.x+r[e],i=this.pos.y+o[e],l=this.room.name;n[l]=n[l]||this.room.getTerrain(),1!==n[l].get(t,i)&&Travel.addMovementOnPos(this.pos.x,this.pos.y,l)}return t}}]);